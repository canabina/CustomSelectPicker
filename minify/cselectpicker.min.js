$.fn.CSelectPicker=function(e){function t(e){function t(e){$.extend(n.settings,e),n.createHtml(),e.onReady&&e.onReady()}var n=this;this.settings={multiple:!1,placehoder:"Select you value"},this.createHtml=function(){if(o.length){o.val(""),o.wrap('<div class="CSP-wrapper"></div>').hide(),$(".CSP-wrapper").append('<div class="CSP-select-window"><div class="CSP-label CSP-toggle-dropdown CSP-placehoder">'+this.settings.placehoder+"</div></div>");var e={};if(o.find("option").each(function(t,o){e[t]={value:$(this).val(),text:$(this).text()}}),$.isEmptyObject(e))console.warn("CSP - Options is select is empty");else{if($(".CSP-select-window").append('<div class="CSP-dropdown-window"></div>'),$.each(e,function(e,t){$(".CSP-dropdown-window").append('<div class="CSP-dropdown-item '+(n.settings.multiple?"":"CSP-toggle-dropdown")+" "+(t.value?"":"CSP-empty")+" "+(n.settings.itemsClass||"")+' " data-value="'+t.value+'">'+t.text+" </div>")}),n.settings.maxDropdownItemsShow){var t=0,i=0;$(".CSP-dropdown-item:lt("+n.settings.maxDropdownItemsShow+")").each(function(e,o){t+=$(this).outerHeight()}),$(".CSP-dropdown-item").each(function(e,t){i+=$(this).outerHeight()});var s=100/(i/t);if(i!=t){$(".CSP-dropdown-window").height(t).append('<div class="CSP-scrollbar-wrapper"><div class="CSP-scrollbar-item" style="height: '+s+'%;"></div></div>');var a=0;$(".CSP-dropdown-window").on("mousewheel",function(e){var o=e.originalEvent.wheelDelta<0?"up":"down";"up"==o?a>-(i-t)&&(a-=29):0>a&&(a+=29);var s=-a*(100/i);$(".CSP-dropdown-item:first-child").css({"margin-top":a+"px"}),$(".CSP-scrollbar-item").css({top:s+"%"}),n.settings.onScrollDropdown&&n.settings.onScrollDropdown(o)})}}$(".CSP-toggle-dropdown").click(function(e){n.toogleDropDown(!1)}),$(document).click(function(e){$(e.target).closest(".CSP-toggle-dropdown").length||$(e.target).is(".CSP-dropdown-item")||$(e.target).is(".CSP-toggle-dropdown")||$(e.target).is(".CSP-scrollbar-item")||!$(".CSP-dropdown-window").hasClass("CSP-dropdown-window-show")||n.toogleDropDown(!0)});var r={};r[o.attr("name")]=[],$(".CSP-dropdown-item").click(function(e){var t=$(this).data("value"),i=($(this).text(),$(".CSP-label"));o.find('option[value="'+t+'"]');if(n.settings.multiple){if($(this).hasClass("CSP-active")){var s=r[o.attr("name")].indexOf(""+t);-1!=s&&r[o.attr("name")].splice(s,1),$(this).removeClass("CSP-active")}else r[o.attr("name")].push(""+t),$(this).addClass("CSP-active");if(r[o.attr("name")].length){var a="";$.each(r[o.attr("name")],function(e,t){a+='<span class="CSP-multiple-item-value">'+o.find('option[value="'+t+'"]').text()+'<span class="CSP-remove-item" data-remove="'+t+'">&#10005</span></span>'}),i.removeClass("CSP-placehoder").html(a)}else i.addClass("CSP-placehoder").text(n.settings.placehoder);o.val(r[o.attr("name")])}else $(".CSP-dropdown-item").removeClass("CSP-active");n.settings.onChange&&n.settings.onChange(o)}),$(document).on("click",".CSP-remove-item",function(e){var t=$(this).data("remove"),i=$('.CSP-dropdown-item[data-value="'+t+'"]');if(i.hasClass("CSP-active")){i.removeClass("CSP-active");var s=n.removeToItemInArray(o.val(),""+t),a=r[o.attr("name")].indexOf(""+t);-1!=a&&r[o.attr("name")].splice(a,1),o.val(s),$(this).parent(".CSP-multiple-item-value").remove()}})}}else console.error("CSP - Not found elem")},this.removeToItemInArray=function(e,t){var o=e.indexOf(t);return-1!=o&&e.splice(o,1),e},this.toogleDropDown=function(e){var t=$(".CSP-dropdown-window");if(e?t.removeClass("CSP-dropdown-window-show"):t.toggleClass("CSP-dropdown-window-show"),n.settings.dropdownStatus){var e=$(".CSP-dropdown-window").hasClass("CSP-dropdown-window-show")?"open":"close";n.settings.dropdownStatus(e)}},t(e)}var o=this;o?new t(e):console.error("CSP - Not checked elem in setting")};