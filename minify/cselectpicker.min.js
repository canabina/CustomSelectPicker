$.fn.CSelectPicker=function(e){function t(e){function t(e){e||(e={}),$.extend(a.settings,e),a.createHtml(),e.onReady&&e.onReady()}var a=this;this.settings={multiple:!1,placehoder:"Select you value"},this.createHtml=function(){if(o.length){o.val(""),o.wrap('<div class="CSP-wrapper"></div>').hide(),$(".CSP-wrapper").append('<div class="CSP-select-window"><div class="CSP-label CSP-toggle-dropdown CSP-placehoder">'+this.settings.placehoder+"</div></div>");var e={};if(o.find("option").each(function(t,o){e[t]={value:$(this).val(),text:$(this).text()}}),$.isEmptyObject(e))console.warn("CSP - Options is select is empty");else{if($(".CSP-select-window").append('<div class="CSP-dropdown-window"></div>'),$.each(e,function(e,t){$(".CSP-dropdown-window").append('<div class="CSP-dropdown-item '+(a.settings.multiple?"":"CSP-toggle-dropdown")+" "+(t.value?"":"CSP-empty")+" "+(a.settings.itemsClass||"")+' " data-value="'+t.value+'">'+t.text+" </div>")}),a.settings.maxDropdownItemsShow){var t=0,s=0;$(".CSP-dropdown-item:lt("+a.settings.maxDropdownItemsShow+")").each(function(e,o){t+=$(this).outerHeight()}),$(".CSP-dropdown-item").each(function(e,t){s+=$(this).outerHeight()});var n=100/(s/t);if(s!=t){$(".CSP-dropdown-window").height(t).append('<div class="CSP-scrollbar-wrapper"><div class="CSP-scrollbar-item" style="height: '+n+'%;"></div></div>');var i=0;$(".CSP-dropdown-window").on("mousewheel",function(e){var o=e.originalEvent.wheelDelta<0?"up":"down";"up"==o?i>-(s-t)&&(i-=29):0>i&&(i+=29);var n=-i*(100/s);$(".CSP-dropdown-item:first-child").css({"margin-top":i+"px"}),$(".CSP-scrollbar-item").css({top:n+"%"}),a.settings.onScrollDropdown&&a.settings.onScrollDropdown(o)})}}$(".CSP-toggle-dropdown").click(function(e){a.toogleDropDown(!1)}),$(document).click(function(e){$(e.target).closest(".CSP-toggle-dropdown").length||$(e.target).is(".CSP-dropdown-item")||$(e.target).is(".CSP-toggle-dropdown")||$(e.target).is(".CSP-scrollbar-item")||!$(".CSP-dropdown-window").hasClass("CSP-dropdown-window-show")||a.toogleDropDown(!0)});var l={},d=$(".CSP-label");l[o.attr("name")]=[],$(".CSP-dropdown-item").click(function(e){var t=$(this).data("value"),s=$(this).text(),n=o.find('option[value="'+t+'"]');if(a.settings.multiple){if(t){if($(this).hasClass("CSP-active")){var i=l[o.attr("name")].indexOf(""+t);-1!=i&&l[o.attr("name")].splice(i,1),$(this).removeClass("CSP-active")}else l[o.attr("name")].push(""+t),$(this).addClass("CSP-active");if(l[o.attr("name")].length){var r="";$.each(l[o.attr("name")],function(e,t){r+='<span class="CSP-multiple-item-value">'+o.find('option[value="'+t+'"]').text()+'<span class="CSP-remove-item" data-remove="'+t+'">&#10005</span></span>'}),d.removeClass("CSP-placehoder").html(r)}else d.addClass("CSP-placehoder").text(a.settings.placehoder);o.val(l[o.attr("name")])}}else $(".CSP-dropdown-item").removeClass("CSP-active"),t?d.removeClass("CSP-placehoder").html('<span class="CSP-item-value">'+s+"</span>"):d.addClass("CSP-placehoder").text(a.settings.placehoder),n.length&&o.val(t),$(this).addClass("CSP-active");a.settings.onChange&&a.settings.onChange(o)}),$(document).on("click",".CSP-remove-item",function(e){var t=$(this).data("remove"),s=$('.CSP-dropdown-item[data-value="'+t+'"]');if(s.hasClass("CSP-active")){s.removeClass("CSP-active");var n=a.removeToItemInArray(o.val(),'"'+t+'"'),i=l[o.attr("name")].indexOf(""+t);-1!=i&&l[o.attr("name")].splice(i,1),l[o.attr("name")].length||d.addClass("CSP-placehoder").text(a.settings.placehoder),o.val(n),$(this).parent(".CSP-multiple-item-value").remove()}})}}else console.error("CSP - Not found elem")},this.removeToItemInArray=function(e,t){var o=e.indexOf(t);return-1!=o&&e.splice(o,1),e},this.toogleDropDown=function(e){var t=$(".CSP-dropdown-window");if(e?t.removeClass("CSP-dropdown-window-show"):t.toggleClass("CSP-dropdown-window-show"),a.settings.dropdownStatus){var e=$(".CSP-dropdown-window").hasClass("CSP-dropdown-window-show")?"open":"close";a.settings.dropdownStatus(e)}},t(e)}var o=this;o?new t(e):console.error("CSP - Not checked elem in setting")};
